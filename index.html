<!DOCTYPE html><link rel="icon" href="data:;base64,=">
<script type="module">
    let global = self,
        DeviceMemory, MemoryBuffer, MemoryWriter,
        HTMLOperator;

    let createSharedMemory = ( initial = 10, maximum = 65e3, shared = true ) => {
        DeviceMemory = new WebAssembly.Memory({ initial, maximum, shared });
        MemoryBuffer = DeviceMemory.buffer;
        MemoryWriter = new DataView( MemoryBuffer );
    }

    let createHTMLOperator = ( ref ) => {
        HTMLOperator = new (class HTMLOperator {
            constructor ( reference ) {
                this.reference = reference
                this.createORSelectBody( reference.body )
                this.clearContents()
            }

            createORSelectBody ( body ) {
                this.body = body ?? this.createElement( "body" )
            } 

            createElement ( tagName ) {
                return this.reference.createElement( tagName )
            }

            clearContents () {
                this.body.innerHTML = ""
                setTimeout(() => {
                    this.reference.head?.remove()
                })
            }

        })( ref ?? global.document ?? new Document() )
    }

    //create memory for navigator
    createSharedMemory()

    //create document operator
    createHTMLOperator()

    console.log( HTMLOperator )

    //debug
    console.warn( DeviceMemory, MemoryBuffer, MemoryWriter, HTMLOperator )
</script>